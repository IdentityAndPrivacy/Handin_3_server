<div>
	{{!-- Login --}}
	<div id="login" class="container">
	<h2>Sign in to register</h2>
		<div class="row">
			<div class="input-field col s10 offset-s1">
				<input id="username" name="username" type="text" class="validate">
				<label for="username">Username</label>
			</div>
		</div>
		<div class="row">
			<div class="input-field col s10 offset-s1">
				<input id="password" name="password" type="password" class="validate">
				<label for="password">Password</label>
			</div>
		</div>
		<div>
			<button id="login-btn" class="btn">Login</button>
		</div>
	</div>	

	{{!-- U2F --}}
	<div id="u2f-div" class="container">
		<h5 id="name"></h5>
		<a href="/start_registration"><button class="btn">Register</button></a>
		<button id="authenticate-btn" onClick='location.href="/start_authentication?username"' class="btn">Authenticate</button>
		<button id="logout-btn" class="btn">Logout</button>
	</div>
</div>

<script type="text/javascript">
	$( document ).ready(function() {
	    $('#login-btn').click(login);
	    $('#logout-btn').click(logout);
	    $('#authenticate-btn').attr('onClick','location.href="/start_authentication?username'+localStorage.getItem('username') );
	    if(localStorage.getItem('username') !== null) {
	    	// Logged in
	    	console.log('Logged in!');
	    	$('#login').hide();
	    	// Registered or not?
	    	if(localStorage.getItem('registered') === null){
	    		$('#authenticate-btn').attr('disabled','disabled');
	    	}
	    	else {
	    		$('#authenticate-btn').removeAttr('disabled');
	    	}
	    }
	    else {
	    	console.log('Not logged in');
	    	$('#u2f-div').hide();
	    }
	    
	});

	// Logging in
	function login(){
	  $.ajax({
	    type: 'POST',
	    url: '/login',
	    data: {
	      username: $('#username').val(), 
	      password: $('#password').val()
	    }
	  })
	  .done(function(data){
	  	if(data.authenticated === true){
	  		// Logged in
	  		$('#login').hide();
	  		$('#u2f-div').show();
	  		localStorage.setItem('username', $('#username').val());
			var name = data.user.firstname + ' ' + data.user.lastname;
	  		console.log(name);
	  		$('#name').html(name);
	  		if(localStorage.getItem('registered') === null){
	    		$('#authenticate-btn').attr('disabled','disabled');
	    	}
	    	else {
	    		$('#authenticate-btn').removeAttr('disabled');
	    	}
	  	}
	  	else {
	  		alert('Error, try again.');
	  	}
	  });
	};

	// Logout
	function logout() {
		localStorage.removeItem('username');
		$('#login').show();
		$('#u2f-div').hide();

	};

	  // Registering device
	  
	
</script>